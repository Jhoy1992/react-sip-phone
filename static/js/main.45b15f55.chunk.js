(this["webpackJsonpreact-sip-phone-example"]=this["webpackJsonpreact-sip-phone-example"]||[]).push([[0],[,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";(function(e,s){n.d(t,"a",(function(){return ct}));var r=n(0),i=n(4),o=n(19),a=n(1),c=n(3),u=n.n(c),d=n(13),l=n(20),p=n(21),f=n(14),h=n(22),S=n.n(h);function g(){return(g=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e}).apply(this,arguments)}function m(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}var E="_1H7C6",y=function(e){if(!e.sessionDescriptionHandler||e.state!==a.d.Established)return{type:"SIPSESSION_HOLD_FAIL"};try{return e.invite({sessionDescriptionHandlerModifiers:[e.sessionDescriptionHandler.holdModifier]}),{type:"SIPSESSION_HOLD_REQUEST",payload:e.id}}catch(t){return{type:"SIPSESSION_HOLD_FAIL"}}},b=function(e){var t=at.getState().device.primaryAudioOutput,n=document.getElementById(e.id),s=new MediaStream;e.sessionDescriptionHandler.peerConnection.getReceivers().forEach((function(e){e.track&&s.addTrack(e.track)})),n?n.setSinkId(t).then((function(){n.srcObject=s,n.play()})):console.log("no media Element"),at.dispatch({type:"REMOTE_AUDIO_CONNECTED"})},v=function(e){var t=at.getState().device.primaryAudioInput;e.sessionDescriptionHandler.peerConnection.getSenders().forEach((function(e){if(console.log(e),e.track&&"audio"===e.track.kind){var n=t;navigator.mediaDevices.getUserMedia({audio:{deviceId:n}}).then((function(t){var n=t.getAudioTracks();e.replaceTrack(n[0])}))}})),at.dispatch({type:"LOCAL_AUDIO_CONNECTED"})},O=function(e){var t=document.getElementById(e);t&&(t.srcObject=null,t.pause())},T={1:[697,1209],2:[697,1336],3:[697,1477],A:[697,1633],4:[770,1209],5:[770,1336],6:[770,1477],B:[770,1633],7:[852,1209],8:[852,1336],9:[852,1477],C:[852,1633],0:[941,1209],"*":[941,1336],"#":[941,1477],D:[941,1633]},C=u.a.PolySynth&&new u.a.PolySynth(2,u.a.Synth),I=u.a.PolySynth&&new u.a.PolySynth(2,u.a.FMSynth),_=function(){var e=this;this.ringtone=function(e){var t=document.getElementById("ringtone");"default"!==e?t?t.setSinkId(e).then((function(){t.play()})):console.log("no media Element"):t.play()},this.ringback=function(t){var n=u.a.context.createMediaStreamDestination();if(console.log(n),C.set({oscillator:{type:"sine"},envelope:{attack:.02,decay:.1,sustain:.2,release:.02}}).connect(n),"default"!==t){var s=document.getElementById("tone");if(s){var r=u.a.context.createMediaStreamDestination();C.connect(r),s.setSinkId(t).then((function(){s.srcObject=r.stream,s.play()}))}}else C.toMaster();e.loop=new u.a.Loop((function(e){C.triggerAttack([440,480]),C.triggerRelease([440,480],e+2)}),6),e.loop.start(0),u.a.Transport.start()},this.stop=function(){try{e.loop.stop(0),u.a.Transport.stop(),C.triggerRelease([440,480])}catch(t){document.getElementById("ringtone").pause()}}},N=new(function(){function e(){}var t=e.prototype;return t.playRing=function(e){var t=at.getState().device.primaryAudioOutput;this.currentTone&&(this.currentTone.stop(),this.currentTone=void 0),"ringback"===e?(this.currentTone=new _,this.currentTone.ringback(t)):"ringtone"==e&&(this.currentTone=new _,this.currentTone.ringtone(t))},t.stopAll=function(){this.currentTone&&(this.currentTone.stop(),this.currentTone=void 0)},e}()),A=function(e){var t=this;this.stateChange=function(e){switch(e){case a.d.Establishing:N.playRing("ringback"),at.dispatch({type:"SIPSESSION_STATECHANGE"});break;case a.d.Established:at.dispatch({type:"SIPSESSION_STATECHANGE"}),N.stopAll(),v(t.session),b(t.session);break;case a.d.Terminating:at.dispatch({type:"SIPSESSION_STATECHANGE"}),N.stopAll(),O(t.session.id);break;case a.d.Terminated:at.dispatch({type:"SIPSESSION_STATECHANGE"}),N.stopAll(),setTimeout((function(){at.dispatch({type:"CLOSE_SESSION",payload:t.session.id})}),5e3);break;default:console.log("Unknown session state change: "+e)}},this.session=e},w=function(e){if(e.length<10)return e;var t="+"+at.getState().sipAccounts.sipAccount._config.defaultCountryCode+e;return e.includes("+")&&10===e.length&&(t=""+e),console.log(t),t},j=function(){function e(e){var t=this;this.stateChange=function(e){switch(e){case a.d.Establishing:at.dispatch({type:"SIPSESSION_STATECHANGE"});break;case a.d.Established:at.dispatch({type:"SIPSESSION_STATECHANGE"}),t.holdAll(),v(t.incomingSession),b(t.incomingSession);break;case a.d.Terminating:at.dispatch({type:"SIPSESSION_STATECHANGE"}),O(t.incomingSession.id);break;case a.d.Terminated:at.dispatch({type:"SIPSESSION_STATECHANGE"}),setTimeout((function(){at.dispatch({type:"CLOSE_SESSION",payload:t.incomingSession.id})}),5e3);break;default:console.log("Unknown session state change: "+e)}},this.incomingSession=e}return e.prototype.holdAll=function(){for(var e=at.getState(),t=e.sipSessions.onHold,n=e.sipSessions.sessions,s=0,r=Object.entries(n);s<r.length;s++){var i=r[s],o=i[0],a=i[1];if(o in t===!1&&o!==this.incomingSession.id)try{return y(a),void at.dispatch({type:"SIPSESSION_HOLD_REQUEST",payload:a.id})}catch(c){return}}},e}(),D=function(){function e(e,t){var n=this;this._config=e,this._credentials=t;var s=a.e.makeURI("sip:"+t.sipuri);if(!s)throw new Error("Failed to create URI");var r={server:e.websocket},i={autoStart:!1,autoStop:!0,noAnswerTimeout:e.noAnswerTimeout||30,logBuiltinEnabled:!1,logConfiguration:!1,logLevel:"error",authorizationPassword:t.password,userAgentString:"OTF-react-sip-phone",hackWssInTransport:!0,transportOptions:r,uri:s,sessionDescriptionHandlerFactoryOptions:{constraints:{audio:{deviceId:"default"},video:!1},alwaysAcquireMediaFirst:!0,iceCheckingTimeout:500}};this._userAgent=new a.e(i),this._registerer=new a.b(this._userAgent,{expires:300,logConfiguration:!1}),this.setupDelegate(),this._userAgent.start().then((function(){n._registerer.register(),n.setupRegistererListener(),at.dispatch({type:"NEW_USERAGENT",payload:n._userAgent})}))}var t=e.prototype;return t.setupDelegate=function(){this._userAgent.delegate={onInvite:function(e){var t=e;t.delegate={onRefer:function(e){console.log(e)}},at.dispatch({type:"INCOMING_CALL",payload:t});var n=new j(t);t.stateChange.addListener(n.stateChange)}}},t.setupRegistererListener=function(){this._registerer.stateChange.addListener((function(e){switch(e){case a.c.Initial:console.log("The user registration has initialized  ");break;case a.c.Registered:console.log("The user is registered ");break;case a.c.Unregistered:console.log("The user is unregistered ");break;case a.c.Terminated:console.log("The user is terminated ")}}))},t.makeCall=function(e){var t=a.e.makeURI("sip:"+w(e)+"@sip.reper.io;user=phone");if(t){console.log("Calling "+e);var n=new a.a(this._userAgent,t);n.delegate={onRefer:function(e){console.log("Referred: "+e)}},at.dispatch({type:"NEW_SESSION",payload:n});var s=new A(n);n.stateChange.addListener(s.stateChange),n.invite().then((function(){console.log("Invite sent!")})).catch((function(e){console.log(e)}))}else console.log("Failed to establish session for outgoing call to "+e)},e}(),R=function(e){function t(){return e.apply(this,arguments)||this}m(t,e);var n=t.prototype;return n.componentDidMount=function(){console.log("mounted"),this.props.sipCredentials.password&&this.initializeSip()},n.initializeSip=function(){var e=new D(this.props.sipConfig,this.props.sipCredentials);this.props.setNewAccount(e)},n.render=function(){return Object(r.createElement)(r.Fragment,null,this.props.children)},t}(r.Component),k={setNewAccount:function(e){return{type:"NEW_ACCOUNT",payload:e}},setPhoneConfig:function(e){return{type:"SET_CONFIG",payload:e}},setCredentials:function(e,t){return void 0===e&&(e=""),void 0===t&&(t=""),{type:"SET_CREDENTIALS",payload:{uri:e,password:t}}}},P=Object(i.b)((function(){return{}}),k)(R),U="_Adysl",M="_3nIZK",L="_3ZwLv",x="_gelBY",H="_3TfJl",F="_6JtnT",B="_2FMhO",G="_2NuIJ",q="_1K5Gw",Q=n(38),W=n(39),Y=n(40),J=function(e){function t(){var t;return(t=e.apply(this,arguments)||this).state={settingsMenu:!1},t}m(t,e);var n=t.prototype;return n.componentDidMount=function(){this.props.getInputAudioDevices(),this.props.getOutputAudioDevices()},n.mapOptions=function(e){var t=[];return e.map((function(e){t.push({value:e.deviceId,label:e.label})})),t},n.handleChangeDevice=function(e,t){"out"===e?this.props.setPrimaryOutput(t):this.props.setPrimaryInput(t)},n.render=function(){var e=this,t=this.props,n=this.state,s=this.mapOptions(t.inputs),i=this.mapOptions(t.outputs);return Object(r.createElement)(r.Fragment,null,Object(r.createElement)("div",{className:U},Object(r.createElement)("div",{className:x},t.name),Object(r.createElement)("div",{id:H,className:n.settingsMenu?L:"",onClick:function(){return e.setState({settingsMenu:!n.settingsMenu})}},Object(r.createElement)("img",{src:Q}))),Object(r.createElement)("div",{id:F,className:n.settingsMenu?"":M},Object(r.createElement)("hr",{style:{width:"100%"}}),Object(r.createElement)("div",{className:G},Object(r.createElement)("img",{className:q,src:Y}),Object(r.createElement)(d.a,{placeholder:"Select Output...",value:i.find((function(e){return e.value===t.primaryOutput}))||null,onChange:function(t){return e.handleChangeDevice("out",t.value)},options:i,id:B})),Object(r.createElement)("div",{className:G},Object(r.createElement)("img",{className:q,src:W}),Object(r.createElement)(d.a,{placeholder:"Select Input...",value:s.find((function(e){return e.value===t.primaryInput})),onChange:function(t){return e.handleChangeDevice("in",t.value)},options:s,id:B})),Object(r.createElement)("hr",{style:{width:"100%"}})))},t}(r.Component),Z={setPrimaryInput:function(e){return{type:"SET_PRIMARY_INPUT",payload:e}},setPrimaryOutput:function(e){return{type:"SET_PRIMARY_OUTPUT",payload:e}},getInputAudioDevices:function(){var e=[];return navigator.mediaDevices.enumerateDevices().then((function(t){t.forEach((function(t){"audioinput"===t.kind&&e.push(t)}))})),{type:"AUDIO_INPUT_DEVICES_DETECTED",payload:e}},getOutputAudioDevices:function(){var e=[];return navigator.mediaDevices.enumerateDevices().then((function(t){t.forEach((function(t){"audiooutput"===t.kind&&e.push(t)}))})),{type:"AUDIO_OUTPUT_DEVICES_DETECTED",payload:e}}},K=Object(i.b)((function(e){return{inputs:e.device.audioInput,outputs:e.device.audioOutput,primaryInput:e.device.primaryAudioInput,primaryOutput:e.device.primaryAudioOutput}}),Z)(J),z="_3dASG",V="_-iUpI",X="_1Yn0M",$="_2Mev0",ee="_30C7x",te="_ftZ8R",ne="_1gnBl",se="_11LDZ",re="_EoCL2",ie="_PaJuy",oe="_25gV2",ae="_1yYD-",ce="_ovMXl",ue="_1-bn8",de=function(e){var t=e.text,n=e.click,s=e.letters;return Object(r.createElement)("div",{id:"sip-dial-button",className:$,onClick:function(){return n()}},t,Object(r.createElement)("div",{style:{opacity:"1"===s?0:1},className:ee},s))},le=function(e){switch(e){case"1":return"1";case"2":return"ABC";case"3":return"DEF";case"4":return"GHI";case"5":return"JKL";case"6":return"MNO";case"7":return"PQRS";case"8":return"TUV";case"9":return"WXYZ";case"0":return"+";default:return""}},pe=function(e){function t(t){var n;(n=e.call(this,t)||this).topRow=[],n.middleRow=[],n.bottomRow=[];for(var s=1;s<4;s++)n.topRow.push(n.getButton(s.toString()));for(var r=4;r<7;r++)n.middleRow.push(n.getButton(r.toString()));for(var i=7;i<10;i++)n.bottomRow.push(n.getButton(i.toString()));return n}m(t,e);var n=t.prototype;return n.getButton=function(e){var t=this;return Object(r.createElement)(de,{key:e,text:e,letters:le(e),click:function(){return t.handleClick(e)}})},n.handleClick=function(e){this.props.session.state===a.d.Established&&(this.sendDTMF(e),function(e,t){var n=T[e];if(n||console.log("invalid DTMF tone input"),C.volume.value=-22,C.set({oscillator:{type:"sine"},envelope:{attack:.02,decay:.1,sustain:.2,release:.02}}),"default"!==t){var s=document.getElementById("tone");if(s){var r=u.a.context.createMediaStreamDestination();C.connect(r),s.setSinkId(t).then((function(){s.srcObject=r.stream,s.play()}))}}else C.toMaster();C.triggerAttackRelease(n,.3)}(e,this.props.deviceId))},n.sendDTMF=function(e){var t={requestOptions:{body:{contentDisposition:"render",contentType:"application/dtmf-relay",content:"Signal="+e+"\r\nDuration=1000"}}};this.props.session.info(t)},n.render=function(){return Object(r.createElement)("div",{className:this.props.open?"":X,id:V},Object(r.createElement)("div",{className:te},this.topRow),Object(r.createElement)("div",{className:te},this.middleRow),Object(r.createElement)("div",{className:te},this.bottomRow),Object(r.createElement)("div",{className:te},this.getButton("*"),this.getButton("0"),this.getButton("#")))},t}(r.Component),fe=Object(i.b)((function(e){return{deviceId:e.device.primaryAudioOutput}}),{})(pe),he=n(41),Se=function(e){function t(){return e.apply(this,arguments)||this}m(t,e);var n=t.prototype;return n.hold=function(){this.checkHoldState()?this.props.unHoldCallRequest(this.props.session,this.props.onHold,this.props.sessions):this.props.holdCallRequest(this.props.session)},n.checkHoldState=function(){return this.props.onHold.includes(this.props.session.id)},n.render=function(){var e=this;return Object(r.createElement)("button",{className:this.checkHoldState()?se:"",id:ne,onClick:function(){return e.hold()}},Object(r.createElement)("img",{src:he}))},t}(r.Component),ge={holdCallRequest:y,unHoldCallRequest:function(e,t,n){return function(s){for(var r=0,i=Object.entries(n);r<i.length;r++){var o=i[r],a=o[0],c=o[1];if(a in t===!1&&a!==e.id)try{c.invite({sessionDescriptionHandlerModifiers:[c.sessionDescriptionHandler.holdModifier]}),s({type:"SIPSESSION_HOLD_REQUEST",payload:c.id})}catch(u){s({type:"SIPSESSION_HOLD_FAIL"})}}try{e.invite(),s({type:"SIPSESSION_UNHOLD_REQUEST",payload:e.id})}catch(u){s({type:"SIPSESSION_UNHOLD_FAIL"})}}}},me=Object(i.b)((function(e){return{stateChanged:e.sipSessions.stateChanged,sessions:e.sipSessions.sessions,userAgent:e.sipAccounts.userAgent,onHold:e.sipSessions.onHold}}),ge)(Se),Ee=n(42),ye=function(e){function t(){var t;return(t=e.apply(this,arguments)||this).state={onMute:!1},t}m(t,e);var n=t.prototype;return n.mute=function(){var e=this;return this.state.onMute?(this.props.unMuteRequest(),new Promise((function(t,n){if(!e.props.session.sessionDescriptionHandler||e.props.session.state!==a.d.Established)return e.props.unMuteFail(),void n("No session to mute");try{return e.props.session.sessionDescriptionHandler.peerConnection.getSenders().forEach((function(e){e.track&&"audio"===e.track.kind&&(e.track.enabled=!0)})),e.props.unMuteSuccess(),e.setState({onMute:!1}),void t()}catch(s){return e.props.unMuteFail(),void n(s)}}))):this.state.onMute?void this.props.muteFail():new Promise((function(t,n){if(!e.props.session.sessionDescriptionHandler||e.props.session.state!==a.d.Established)return e.props.muteFail(),void n("No session to mute");try{e.props.muteRequest();var s=e.props.session.sessionDescriptionHandler.peerConnection;return console.log(s.getSenders()),s.getSenders().forEach((function(e){e.track&&"audio"===e.track.kind&&(e.track.enabled=!1)})),e.props.muteSuccess(),e.setState({onMute:!0}),void t()}catch(r){return e.props.muteFail(),void n(r)}}))},n.render=function(){var e=this;return Object(r.createElement)("div",{className:this.state.onMute?se:"",id:ne,onClick:function(){return e.mute()}},Object(r.createElement)("img",{src:Ee}))},t}(r.Component),be={muteRequest:function(){return function(e){e({type:"SIPSESSION_MUTE_REQUEST"})}},muteSuccess:function(){return function(e){e({type:"SIPSESSION_MUTE_SUCCESS"})}},muteFail:function(){return function(e){e({type:"SIPSESSION_MUTE_FAIL"})}},unMuteRequest:function(){return function(e){e({type:"SIPSESSION_UNMUTE_REQUEST"})}},unMuteSuccess:function(){return function(e){e({type:"SIPSESSION_UNMUTE_SUCCESS"})}},unMuteFail:function(){return function(e){e({type:"SIPSESSION_UNMUTE_FAIL"})}}},ve=Object(i.b)((function(e){return{stateChanged:e.sipSessions.stateChanged,sessions:e.sipSessions.sessions,userAgent:e.sipAccounts.userAgent}}),be)(ye),Oe=n(43),Te=function(e){function t(){return e.apply(this,arguments)||this}m(t,e);var n=t.prototype;return n.blindTransferCall=function(){this.props.blindTransferRequest();var e=a.e.makeURI("sip:"+w(this.props.destination)+"@sip.reper.io;user=phone");if(e)try{this.props.session.refer(e),this.props.blindTransferSuccess()}catch(t){console.log(t)}else this.props.blindTransferFail()},n.render=function(){var e=this;return Object(r.createElement)(r.Fragment,null,Object(r.createElement)("button",{className:ue,onClick:function(){return e.blindTransferCall()}},Object(r.createElement)("img",{src:Oe})))},t}(r.Component),Ce={blindTransferRequest:function(){return function(e){e({type:"SIPSESSION_BLIND_TRANSFER_REQUEST"})}},blindTransferSuccess:function(){return function(e){e({type:"SIPSESSION_BLIND_TRANSFER_SUCCESS"})}},blindTransferFail:function(){return function(e){e({type:"SIPSESSION_BLIND_TRANSFER_FAIL"})}}},Ie=Object(i.b)((function(e){return{stateChanged:e.sipSessions.stateChanged,sessions:e.sipSessions.sessions,userAgent:e.sipAccounts.userAgent}}),Ce)(Te),_e=n(44),Ne=n(45),Ae=function(e){function t(){var t;return(t=e.apply(this,arguments)||this).state={attendedTransferSessionPending:null,attendedTransferSessionReady:null},t}m(t,e);var n=t.prototype;return n.attendedTransferCall=function(){var e=this;this.holdAll(),this.props.attendedTransferRequest();var t=a.e.makeURI("sip:"+w(this.props.destination)+"@sip.reper.io;user=phone");if(t){var n=new a.a(this.props.userAgent,t);at.dispatch({type:"NEW_ATTENDED_TRANSFER",payload:n}),this.setState({attendedTransferSessionPending:n}),n.stateChange.addListener((function(t){switch(t){case a.d.Initial:case a.d.Establishing:e.props.stateChange(t,n.id),e.props.attendedTransferPending();break;case a.d.Established:e.setState({attendedTransferSessionReady:n}),e.props.attendedTransferReady(),e.setState({attendedTransferSessionPending:!1}),e.props.stateChange(t,n.id);break;case a.d.Terminating:e.props.stateChange(t,n.id);break;case a.d.Terminated:e.props.stateChange(t,n.id),e.attendedTransferClear(),setTimeout((function(){e.props.closeSession(n.id)}),5e3);break;default:console.log("Unknown session state change: "+t)}})),n.invite().catch((function(t){e.props.attendedTransferFail(),console.log(t)}))}else this.props.attendedTransferFail()},n.attendedTransferClear=function(){this.setState({attendedTransferSessionPending:null}),this.setState({attendedTransferSessionReady:null}),this.props.started(!1)},n.connectAttendedTransfer=function(e){try{this.props.session.refer(e),this.props.attendedTransferSuccess(),this.setState({attendedTransferSessionReady:null})}catch(t){console.log(t)}},n.cancelAttendedTransfer=function(e){e.cancel(),this.props.attendedTransferCancel(),this.setState({attendedTransferSessionPending:null}),this.setState({attendedTransferSession:null})},n.holdAll=function(){var e=at.getState().sipSessions.onHold;if(this.props.session.id in e===!1)try{return void this.props.holdCallRequest(this.props.session)}catch(t){return}},n.render=function(){var e=this;return this.state.attendedTransferSessionReady?Object(r.createElement)(r.Fragment,null,Object(r.createElement)(Pe,{session:this.state.attendedTransferSessionReady,phoneConfig:{disabledButtons:["numpad","transfer"]}}),Object(r.createElement)("button",{className:ue,onClick:function(){e.props.started(!1),e.connectAttendedTransfer(e.state.attendedTransferSessionReady)}},Object(r.createElement)("img",{src:Oe}))):this.state.attendedTransferSessionPending?Object(r.createElement)("button",{className:re,onClick:function(){e.props.started(!1),e.cancelAttendedTransfer(e.state.attendedTransferSessionPending)}},Object(r.createElement)("img",{src:Ne})):Object(r.createElement)("button",{className:ue,onClick:function(){e.props.started(!0),e.attendedTransferCall()}},Object(r.createElement)("img",{src:_e}))},t}(r.Component),we={holdCallRequest:y,attendedTransferRequest:function(){return function(e){e({type:"SIPSESSION_ATTENDED_TRANSFER_REQUEST"})}},attendedTransferCancel:function(){return function(e){e({type:"SIPSESSION_ATTENDED_TRANSFER_CANCEL"})}},attendedTransferReady:function(){return function(e){e({type:"SIPSESSION_ATTENDED_TRANSFER_READY"})}},attendedTransferPending:function(){return function(e){e({type:"SIPSESSION_ATTENDED_TRANSFER_PENDING"})}},attendedTransferSuccess:function(){return function(e){e({type:"SIPSESSION_ATTENDED_TRANSFER_SUCCESS"})}},attendedTransferFail:function(){return function(e){e({type:"SIPSESSION_ATTENDED_TRANSFER_FAIL"})}},stateChange:function(e,t){return function(n){n({type:"SIPSESSION_STATECHANGE",payload:{state:e,id:t}})}},closeSession:function(e){return function(t){t({type:"CLOSE_SESSION",payload:e})}}},je=Object(i.b)((function(e){return{stateChanged:e.sipSessions.stateChanged,sessions:e.sipSessions.sessions,userAgent:e.sipAccounts.userAgent}}),we)(Ae),De=n(46),Re=function(e){function t(t){var n;return(n=e.call(this,t)||this).state={dialpadOpen:!1,transferMenu:!1,ended:!1,transferDialString:"",attendedTransferStarted:!1,duration:0,counterStarted:!1},n.attendedProcess=n.attendedProcess.bind(function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(n)),n}m(t,e);var n=t.prototype;return n.componentDidUpdate=function(e){e.session.state!==a.d.Established||this.state.counterStarted||this.handleCounter(),e.session.state===a.d.Terminated&&!1===this.state.ended&&this.setState({ended:!0})},n.endCall=function(){var e=this;this.props.session.state===a.d.Established?this.props.session.bye():this.props.session.state!==a.d.Initial&&this.props.session.state!==a.d.Establishing||(N.stopAll(),function(e){if(I.triggerAttack(["C4","E4"],"+0.1"),I.triggerRelease(["C4","E4"],"+0.14"),I.triggerAttack(["D4","G4"],"+0.14"),I.triggerRelease(["D4","G4"],"+0.18"),"default"!==e){var t=document.getElementById("tone");if(t){var n=u.a.context.createMediaStreamDestination();C.connect(n),t.setSinkId(e).then((function(){t.srcObject=n.stream,t.play()}))}}else I.toMaster()}(this.props.deviceId),this.props.session.cancel()),this.setState({ended:!0}),setTimeout((function(){e.props.session.dispose(),e.props.endCall(e.props.session.id)}),5e3)},n.attendedProcess=function(e){this.setState({attendedTransferStarted:e})},n.handleCounter=function(){var e=this;this.props.session&&this.props.session.state!==a.d.Terminated&&(!1===this.state.counterStarted&&this.setState({counterStarted:!0}),setTimeout((function(){e.setState({duration:e.state.duration+1}),e.handleCounter()}),1e3))},n.render=function(){var e=this,t=this.state,n=this.props;return Object(r.createElement)(r.Fragment,null,Object(r.createElement)("hr",{style:{width:"100%"}}),Object(r.createElement)("div",null,n.session.remoteIdentity.uri.normal.user+" - "+n.session.remoteIdentity._displayName),Object(r.createElement)("br",null),Object(r.createElement)("div",null,function(e){switch(e){case"Established":return"Connected";case"Establishing":return"Calling...";case"Initial":return"Initial";case"Terminating":case"Terminated":return"Ended";default:return"Unknown Status"}}(n.session.state)),Object(r.createElement)("br",null),this.props.session.state===a.d.Initial||this.props.session.state===a.d.Establishing?null:Object(r.createElement)("div",null,function(e){var t,n=Math.floor(e/60),s=Math.floor(n/60),r=e%60;return t=s&&s<10?"0"+s+":":s?s+":":"00:",""+(s?t:"")+((n%=60)&&n<10?"0"+n+":":n?n+":":"00:")+(r&&r<10?"0"+r:r?""+r:"00")}(this.state.duration)),t.ended?null:Object(r.createElement)(r.Fragment,null,Object(r.createElement)(fe,{open:t.dialpadOpen,session:n.session}),Object(r.createElement)("div",{className:oe},n.phoneConfig.disabledButtons.includes("mute")?null:Object(r.createElement)(ve,{session:n.session}),Object(r.createElement)("button",{className:re,disabled:t.ended,onClick:function(){return e.endCall()}},Object(r.createElement)("img",{src:Ne})),n.phoneConfig.disabledButtons.includes("hold")?null:Object(r.createElement)(me,{session:n.session}),n.phoneConfig.disabledButtons.includes("numpad")?null:Object(r.createElement)("div",{id:ne,className:t.dialpadOpen?se:"",onClick:function(){return e.setState({dialpadOpen:!t.dialpadOpen})}},Object(r.createElement)("img",{src:De})),n.phoneConfig.disabledButtons.includes("transfer")?null:Object(r.createElement)("div",{id:ne,className:t.transferMenu?se:"",onClick:function(){return e.setState({transferMenu:!t.transferMenu})}},Object(r.createElement)("img",{src:Oe})),Object(r.createElement)("div",{id:ae,className:t.transferMenu?"":X},Object(r.createElement)("input",{id:ce,onChange:function(t){return e.setState({transferDialString:t.target.value})},placeholder:"Enter the transfer destination..."}),this.state.attendedTransferStarted?null:Object(r.createElement)(Ie,{destination:t.transferDialString,session:n.session}),Object(r.createElement)(je,{started:this.attendedProcess,destination:t.transferDialString,session:n.session}))),Object(r.createElement)("audio",{id:this.props.session.id,autoPlay:!0})))},t}(r.Component),ke={endCall:function(e){return{type:"CLOSE_SESSION",payload:e}}},Pe=Object(i.b)((function(e){return{stateChanged:e.sipSessions.stateChanged,sessions:e.sipSessions.sessions,userAgent:e.sipAccounts.userAgent,deviceId:e.device.primaryAudioOutput}}),ke)(Re),Ue=n(47),Me=n(48),Le=function(e){function t(){return e.apply(this,arguments)||this}m(t,e);var n=t.prototype;return n.componentDidMount=function(){console.log("this is the session"),console.log(this.props.session),N.stopAll(),N.playRing("ringtone")},n.handleAccept=function(){N.stopAll(),this.props.session.accept(),this.props.acceptCall(this.props.session)},n.handleDecline=function(){N.stopAll(),this.props.session.reject(),this.props.declineCall(this.props.session)},n.render=function(){var e=this,t=this.props;return Object(r.createElement)("div",{id:z},"Incoming: "+t.session.remoteIdentity.uri.normal.user+" - "+t.session.remoteIdentity._displayName,Object(r.createElement)("div",{className:re,onClick:function(){return e.handleDecline()}},Object(r.createElement)("img",{src:Ne})),Object(r.createElement)("div",{className:ie,onClick:function(){return e.handleAccept()}},Object(r.createElement)("img",{src:Ue})),Object(r.createElement)("audio",{id:"ringtone",loop:!0},Object(r.createElement)("source",{src:Me,type:"audio/mpeg"})),Object(r.createElement)("audio",{id:this.props.session.id,autoPlay:!0}))},t}(r.Component),xe={acceptCall:function(e){return{type:"ACCEPT_CALL",payload:e}},declineCall:function(e){return{type:"DECLINE_CALL",payload:e}}},He=Object(i.b)((function(e){return{stateChanged:e.sipSessions.stateChanged}}),xe)(Le),Fe=function(e){function t(){return e.apply(this,arguments)||this}return m(t,e),t.prototype.render=function(){return Object(r.createElement)(r.Fragment,null,function(e){var t=[];for(var n in e)t.push(Object(r.createElement)(He,{session:e[n],key:n}));return t}(this.props.incomingCalls),function(e,t,n){var s=[];for(var i in e)n.includes(i)||s.push(Object(r.createElement)(Pe,{session:e[i],key:i,phoneConfig:t}));return s}(this.props.sessions,this.props.phoneConfig,this.props.attendedTransfers))},t}(r.Component),Be=Object(i.b)((function(e){return{sessions:e.sipSessions.sessions,incomingCalls:e.sipSessions.incomingCalls,attendedTransfers:e.sipSessions.attendedTransfers}}))(Fe),Ge="_3GsXr",qe="_32AFz",Qe="_2sye_",We=function(e){function t(){var t;return(t=e.apply(this,arguments)||this).state={currentDialString:""},t}m(t,e);var n=t.prototype;return n.handleDial=function(){this.checkDialstring()||this.props.sipAccount.makeCall(""+this.state.currentDialString)},n.checkDialstring=function(){return 0===this.state.currentDialString.length},n.render=function(){var e=this;return Object(r.createElement)("div",{className:Qe},Object(r.createElement)("input",{className:qe,onKeyPress:function(t){"Enter"===t.key&&(e.handleDial(),t.preventDefault())},placeholder:"Enter the number to dial...",onChange:function(t){return e.setState({currentDialString:t.target.value})}}),Object(r.createElement)("button",{className:Ge,disabled:this.checkDialstring(),onClick:function(){return e.handleDial()}},Object(r.createElement)("img",{src:Ue})))},t}(r.Component),Ye=Object(i.b)((function(e){return{sipAccount:e.sipAccounts.sipAccount}}),{})(We);var Je=function(e){var t,n=e.Symbol;return"function"===typeof n?n.observable?t=n.observable:(t=n("observable"),n.observable=t):t="@@observable",t}("undefined"!==typeof self?self:"undefined"!==typeof window?window:"undefined"!==typeof e?e:s),Ze=function(){return Math.random().toString(36).substring(7).split("").join(".")},Ke={INIT:"@@redux/INIT"+Ze(),REPLACE:"@@redux/REPLACE"+Ze(),PROBE_UNKNOWN_ACTION:function(){return"@@redux/PROBE_UNKNOWN_ACTION"+Ze()}};function ze(e){if("object"!==typeof e||null===e)return!1;for(var t=e;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}function Ve(e,t){var n=t&&t.type;return"Given "+(n&&'action "'+String(n)+'"'||"an action")+', reducer "'+e+'" returned undefined. To ignore an action, you must explicitly return the previous state. If you want this reducer to hold no value, you can return null instead of undefined.'}function Xe(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function $e(e,t){var n=Object.keys(e);return Object.getOwnPropertySymbols&&n.push.apply(n,Object.getOwnPropertySymbols(e)),t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n}function et(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?$e(n,!0).forEach((function(t){Xe(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):$e(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function tt(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return 0===t.length?function(e){return e}:1===t.length?t[0]:t.reduce((function(e,t){return function(){return e(t.apply(void 0,arguments))}}))}var nt=function(e){for(var t=Object.keys(e),n={},s=0;s<t.length;s++){var r=t[s];0,"function"===typeof e[r]&&(n[r]=e[r])}var i,o=Object.keys(n);try{!function(e){Object.keys(e).forEach((function(t){var n=e[t];if("undefined"===typeof n(void 0,{type:Ke.INIT}))throw new Error('Reducer "'+t+"\" returned undefined during initialization. If the state passed to the reducer is undefined, you must explicitly return the initial state. The initial state may not be undefined. If you don't want to set a value for this reducer, you can use null instead of undefined.");if("undefined"===typeof n(void 0,{type:Ke.PROBE_UNKNOWN_ACTION()}))throw new Error('Reducer "'+t+"\" returned undefined when probed with a random type. Don't try to handle "+Ke.INIT+' or other actions in "redux/*" namespace. They are considered private. Instead, you must return the current state for any unknown actions, unless it is undefined, in which case you must return the initial state, regardless of the action type. The initial state may not be undefined, but can be null.')}))}(n)}catch(a){i=a}return function(e,t){if(void 0===e&&(e={}),i)throw i;for(var s=!1,r={},a=0;a<o.length;a++){var c=o[a],u=n[c],d=e[c],l=u(d,t);if("undefined"===typeof l){var p=Ve(c,t);throw new Error(p)}r[c]=l,s=s||l!==d}return(s=s||o.length!==Object.keys(e).length)?r:e}}({sipAccounts:function(e,t){void 0===e&&(e={sipAccount:null,userAgent:null,status:""});var n=t.type,s=t.payload;switch(n){case"NEW_ACCOUNT":return g(g({},e),{},{sipAccount:t.payload});case"NEW_USERAGENT":return g(g({},e),{},{userAgent:s});default:return e}},sipSessions:function(e,t){var n,s,r,i;void 0===e&&(e={sessions:{},incomingCalls:{},stateChanged:0,onHold:[],attendedTransfers:[]});var o=t.type,a=t.payload;switch(o){case"INCOMING_CALL":return console.log("Incoming call"),g(g({},e),{},{incomingCalls:g(g({},e.incomingCalls),{},(n={},n[a.id]=a,n))});case"NEW_SESSION":return console.log("New session added"),g(g({},e),{},{sessions:g(g({},e.sessions),{},(s={},s[a.id]=a,s))});case"NEW_ATTENDED_TRANSFER":return g(g({},e),{},{sessions:g(g({},e.sessions),{},(r={},r[a.id]=a,r)),attendedTransfers:[].concat(e.attendedTransfers,[a.id])});case"ACCEPT_CALL":var c=g({},e.incomingCalls);return delete c[a.id],g(g({},e),{},{incomingCalls:c,sessions:g(g({},e.sessions),{},(i={},i[a.id]=a,i))});case"DECLINE_CALL":var u=g({},e.incomingCalls);return delete u[a.id],g(g({},e),{},{incomingCalls:u});case"SIPSESSION_STATECHANGE":return g(g({},e),{},{stateChanged:e.stateChanged+1});case"CLOSE_SESSION":var d=g({},e.incomingCalls),l=g({},e.sessions);delete l[a],delete d[a];var p=[].concat(e.onHold).filter((function(e){return e!==a}));return g(g({},e),{},{sessions:l,incomingCalls:d,onHold:p});case"SIPSESSION_HOLD_REQUEST":return g(g({},e),{},{onHold:[].concat(e.onHold,[a])});case"SIPSESSION_UNHOLD_REQUEST":var f=[].concat(e.onHold).filter((function(e){return e!==a}));return g(g({},e),{},{onHold:f});default:return e}},device:function(e,t){void 0===e&&(e={audioInput:[],audioOutput:[],primaryAudioOutput:"default",primaryAudioInput:"default"});var n=t.type,s=t.payload;switch(n){case"AUDIO_INPUT_DEVICES_DETECTED":return g(g({},e),{},{audioInput:s});case"AUDIO_OUTPUT_DEVICES_DETECTED":return g(g({},e),{},{audioOutput:s});case"SET_PRIMARY_OUTPUT":return g(g({},e),{},{primaryAudioOutput:s});case"SET_PRIMARY_INPUT":return g(g({},e),{},{primaryAudioInput:s});default:return e}},config:function(e,t){switch(void 0===e&&(e={uri:"",password:"",phoneConfig:{}}),t.type){case"SET_CONFIG":return g(g({},e),{},{phoneConfig:t.payload});case"SET_CREDENTIALS":return g(g({},e),{},{uri:t.payload.uri,password:t.payload.password});default:return e}}}),st=[p.a],rt={key:"root",storage:S.a,whitelist:["device"]},it=function e(t,n,s){var r;if("function"===typeof n&&"function"===typeof s||"function"===typeof s&&"function"===typeof arguments[3])throw new Error("It looks like you are passing several store enhancers to createStore(). This is not supported. Instead, compose them together to a single function.");if("function"===typeof n&&"undefined"===typeof s&&(s=n,n=void 0),"undefined"!==typeof s){if("function"!==typeof s)throw new Error("Expected the enhancer to be a function.");return s(e)(t,n)}if("function"!==typeof t)throw new Error("Expected the reducer to be a function.");var i=t,o=n,a=[],c=a,u=!1;function d(){c===a&&(c=a.slice())}function l(){if(u)throw new Error("You may not call store.getState() while the reducer is executing. The reducer has already received the state as an argument. Pass it down from the top reducer instead of reading it from the store.");return o}function p(e){if("function"!==typeof e)throw new Error("Expected the listener to be a function.");if(u)throw new Error("You may not call store.subscribe() while the reducer is executing. If you would like to be notified after the store has been updated, subscribe from a component and invoke store.getState() in the callback to access the latest state. See https://redux.js.org/api-reference/store#subscribelistener for more details.");var t=!0;return d(),c.push(e),function(){if(t){if(u)throw new Error("You may not unsubscribe from a store listener while the reducer is executing. See https://redux.js.org/api-reference/store#subscribelistener for more details.");t=!1,d();var n=c.indexOf(e);c.splice(n,1),a=null}}}function f(e){if(!ze(e))throw new Error("Actions must be plain objects. Use custom middleware for async actions.");if("undefined"===typeof e.type)throw new Error('Actions may not have an undefined "type" property. Have you misspelled a constant?');if(u)throw new Error("Reducers may not dispatch actions.");try{u=!0,o=i(o,e)}finally{u=!1}for(var t=a=c,n=0;n<t.length;n++){(0,t[n])()}return e}function h(e){if("function"!==typeof e)throw new Error("Expected the nextReducer to be a function.");i=e,f({type:Ke.REPLACE})}function S(){var e,t=p;return(e={subscribe:function(e){if("object"!==typeof e||null===e)throw new TypeError("Expected the observer to be an object.");function n(){e.next&&e.next(l())}return n(),{unsubscribe:t(n)}}})[Je]=function(){return this},e}return f({type:Ke.INIT}),(r={dispatch:f,subscribe:p,getState:l,replaceReducer:h})[Je]=S,r}(Object(f.a)(rt,nt),Object(l.composeWithDevTools)(function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e){return function(){var n=e.apply(void 0,arguments),s=function(){throw new Error("Dispatching while constructing your middleware is not allowed. Other middleware would not be applied to this dispatch.")},r={getState:n.getState,dispatch:function(){return s.apply(void 0,arguments)}},i=t.map((function(e){return e(r)}));return et({},n,{dispatch:s=tt.apply(void 0,i)(n.dispatch)})}}}.apply(void 0,st))),ot=Object(f.b)(it),at=it,ct=function(e){var t=e.name,n=e.width,s=void 0===n?300:n,a=e.height,c=void 0===a?600:a,u=e.phoneConfig,d=void 0===u?{disabledButtons:[]}:u,l=e.sipConfig,p=e.sipCredentials,f=e.containerStyle,h=void 0===f?{}:f;return Object(r.createElement)(i.a,{store:at},Object(r.createElement)(o.a,{loading:null,persistor:ot},Object(r.createElement)(P,{sipConfig:l,sipCredentials:p,phoneConfig:d},Object(r.createElement)("div",{className:E,style:g(g({},h),{},{width:(s<300?300:s)+"px",height:(c<600?600:c)+"px"})},Object(r.createElement)(K,{name:t}),Object(r.createElement)(Ye,null),Object(r.createElement)(Be,{phoneConfig:d}),Object(r.createElement)("audio",{id:"tone",autoPlay:!0})))))}}).call(this,n(15),n(16)(e))},,,,,,,function(e,t,n){e.exports=n(50)},function(e,t,n){},,,,,,,,,,,,,function(e,t,n){e.exports=n.p+"static/media/settings-24px~HQuidduc.83d38c97.svg"},function(e,t,n){e.exports=n.p+"static/media/mic-24px~xExSpqQP.58e127e9.svg"},function(e,t,n){e.exports=n.p+"static/media/volume_up-24px~qJQJhpOr.aed75bc0.svg"},function(e,t,n){e.exports=n.p+"static/media/phone_paused-24px~TWxpQtZf.84161f8e.svg"},function(e,t,n){e.exports=n.p+"static/media/mic_off-24px~bjejwOqd.ba53335f.svg"},function(e,t,n){e.exports=n.p+"static/media/arrow_forward-24px~UJhdZXVe.66bdaa19.svg"},function(e,t,n){e.exports=n.p+"static/media/phone_in_talk-24px~DQfZjkDQ.77e3ccda.svg"},function(e,t,n){e.exports=n.p+"static/media/call_end-24px~HrwYCAOf.39365fed.svg"},function(e,t,n){e.exports=n.p+"static/media/dialpad-24px~cidqBzRK.348fe506.svg"},function(e,t,n){e.exports=n.p+"static/media/call-24px~AGZUevvA.f3b7d629.svg"},function(e,t,n){e.exports=n.p+"static/media/ring.69b29a4c.mp3"},function(e,t,n){},function(e,t,n){"use strict";n.r(t);n(25);var s=n(0),r=n.n(s),i=n(5),o=n.n(i),a=n(17);n(49);const c=new URLSearchParams(window.location.search),u=c.get("sipuri"),d=c.get("password"),l=c.get("websocket"),p=c.get("name");var f=()=>r.a.createElement(a.a,{name:p||"",sipCredentials:{sipuri:u||"",password:d||""},sipConfig:{websocket:l||"",defaultCountryCode:"1"},width:0});o.a.render(r.a.createElement(f,null),document.getElementById("root"))}],[[24,1,2]]]);
//# sourceMappingURL=main.45b15f55.chunk.js.map